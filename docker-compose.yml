version: "3.1"
services:
    backend:
        container_name: backend
        build:
            context: .
            dockerfile: CoronaApp_backend\Dockerfile
        depends_on:
            - sqldata
        tty: true
        ports:
          - "49159:443"
          - "49160:80"
        environment:
          - ASPNETCORE_ENVIRONMENT=Development
          - ASPNETCORE_URLS=https://+:443;http://+:80
          - ASPNETCORE_HTTPS_PORT=49159
          - ASPNETCORE_Kestrel__Certificates__Default__Password=uFzF0lGDTLymUTni0ZM8KA
          - ASPNETCORE_Kestrel__Certificates__Default__Path=/https/aspnetapp.pfx
        networks:
          - corona_app
        volumes:
          - D:\Anton_profile\Programming\C#\CoronaApp_current\CoronaApp\SSL:/https:ro
    
    testcors:
        container_name: test_cors
        build:
            context: .
            dockerfile: TestCors\Dockerfile
        tty: true
        ports:
          - "49157:443"
          - "49158:80"
        environment:
          - ASPNETCORE_ENVIRONMENT=Development
          - ASPNETCORE_URLS=https://+:443;http://+:80
          - ASPNETCORE_HTTPS_PORT=49157
          - ASPNETCORE_Kestrel__Certificates__Default__Password=uFzF0lGDTLymUTni0ZM8KA
          - ASPNETCORE_Kestrel__Certificates__Default__Path=/https/aspnetapp.pfx
        networks:
          - corona_app
        volumes:
          - D:\Anton_profile\Programming\C#\CoronaApp_current\CoronaApp\SSL:/https:ro
    
    sqldata:
        image: "mcr.microsoft.com/mssql/server:2019-latest"
        container_name: mssql
        restart: always
        ports:
            - "1439:1433"
        environment:
            SA_PASSWORD: "DockerMSSQL2019"
            ACCEPT_EULA: "Y"
        networks:
          - corona_app
    
    elasticsearch:
        container_name: elastic_7
        image: docker.elastic.co/elasticsearch/elasticsearch:7.16.1
        ports:
          - 9200:9200
        volumes:
          - elasticsearch-data:/usr/share/elasticsearch/data
        environment:
          - xpack.security.enabled=true
          - xpack.monitoring.enabled=true
          - xpack.watcher.enabled=false
          - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
          - discovery.type=single-node
        networks:
          - corona_app

    kibana:
        container_name: kibana_7
        image: docker.elastic.co/kibana/kibana:7.16.1
        ports:
          - 5601:5601
        depends_on:
          - elasticsearch
        environment:
          - ELASTICSEARCH_URL=http://localhost:9200
        networks:
          - corona_app

networks:
  corona_app:
    driver: bridge

volumes:
  elasticsearch-data: